<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>TODO List</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="apple-touch-icon" href="img/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    body{font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(120deg,#f0f4f8 0%,#d9e7fa 100%);margin:0;padding:1rem;color:#222}
    header,footer{background:#2563eb;color:#fff;padding:1.2rem 2rem;text-align:center;border-radius:0 0 16px 16px;box-shadow:0 2px 8px rgba(37,99,235,.08)}
    main{max-width:800px;margin:2rem auto;background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.07);padding:2rem}
    h1,h2{color:#2563eb;margin-top:0}
    button{background:#2563eb;color:#fff;border:none;border-radius:8px;padding:.6em 1.2em;font-size:1em;cursor:pointer;transition:background .2s}
    button:hover{background:#1e40af}
    #entrada{padding:.5em}
    #lista{list-style:none;padding:0;margin-top:1rem}
    .item{display:flex;align-items:center;gap:.5rem;margin:.4rem 0;padding:.6rem .8rem;background:#f3f6fb;border-radius:10px;box-shadow:0 2px 6px rgba(37,99,235,.06)}
    .txt{flex:1;word-break:break-word}
    .del{background:#ef4444}
    .del:hover{background:#b91c1c}
    @media (max-width:600px){main{padding:1rem} header,footer{padding:1rem}}
  </style>
</head>

<body>
  <header><h1>Mi Aplicación</h1></header>
  <button onclick="crear()">Crear tarea</button>
  <script>
    async function crear(){
      const title = prompt('Título:');
      if(!title) return;
      const r = await fetch('/api/tasks.php', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({title})
      });
      console.log(await r.json());
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/public-html/sw.js')
          .then(r => console.log('SW ok', r))
          .catch(console.error);
      });
    }
  </script>

  <main>
    <h2>Formulario de Texto</h2>
    <div id="contenedor">
      <input type="text" id="entrada" placeholder="ingresa texto..." />
      <button id="btnLeer">Leer</button>
      <button id="btnBorrarTodo" title="Borrar todas las tareas">Borrar todo</button>
    </div>

    <!-- ahora usamos una lista -->
    <ul id="lista"></ul>
  </main>

  <footer><p>© 2023 Mi Aplicación. Todos los derechos reservados.</p></footer>

  <script>
    const entrada = document.getElementById("entrada");
    const lista = document.getElementById("lista");
    const btnLeer = document.getElementById("btnLeer");
    const btnBorrarTodo = document.getElementById("btnBorrarTodo");

    // estado en memoria + persistencia
    let tareas = JSON.parse(localStorage.getItem("tareas") || "[]");

    function guardar() {
      localStorage.setItem("tareas", JSON.stringify(tareas));
    }

    function render() {
      lista.innerHTML = "";
      tareas.forEach((t, idx) => {
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <span class="txt">${t}</span>
          <button class="del" data-i="${idx}">Eliminar</button>
        `;
        lista.appendChild(li);
      });
    }

    function agregar() {
      const val = entrada.value.trim();
      if (!val) return;
      tareas.push(val);
      guardar();
      render();
      entrada.value = "";
      entrada.focus();
    }

    // borrar una tarea (event delegation)
    lista.addEventListener("click", (e) => {
      if (e.target.classList.contains("del")) {
        const i = Number(e.target.getAttribute("data-i"));
        tareas.splice(i, 1);
        guardar();
        render();
      }
    });

    // borrar todas
    function borrarTodo() {
      if (!tareas.length) return;
      if (confirm("¿Borrar TODAS las tareas?")) {
        tareas = [];
        guardar();
        render();
        alert("Texto borrado ❌");
      }
    }

    // eventos
    btnLeer.addEventListener("click", agregar);
    entrada.addEventListener("keydown", (e) => {
      if (e.key === "Enter") agregar();
    });
    btnBorrarTodo.addEventListener("click", borrarTodo);

    // al cargar
    render();
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(r => console.log('SW listo', r.scope))
        .catch(console.error);
    });
  }
  </script>
</body>
</html>